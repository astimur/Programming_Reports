% !TEX encoding = Windows Cyrillic
\documentclass[12pt]{article}
\pagestyle{plain}

\usepackage{amsmath,amssymb,amsthm,amsfonts,amscd,array,graphicx}
\usepackage{amsthm}
\usepackage{graphicx}
 \graphicspath{{pictures/}}
 \DeclareGraphicsExtensions{.pdf,.png,.jpg}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage{mathtools}
\usepackage{cmap}
\usepackage{hyperref}

\usepackage[left=3cm,right=3cm, top=3cm, bottom=3cm, bindingoffset=0cm]{geometry}

\DeclareMathOperator*{\argmax}{argmax}

\theoremstyle{definition}
\newtheorem{exercise}{Задача}
\newtheorem{defin}{Определение}

\theoremstyle{theorem}
\newtheorem{theorem}{Теорема}
\newtheorem{propos}[theorem]{Утверждение}
\newtheorem{cor}[theorem]{Следствие}
\newtheorem{lem}[theorem]{Лемма}
\newtheorem{remark}[theorem]{Замечание}
\newtheorem{quest}[theorem]{Вопрос}

\title{Отчёт по дифференциальным уравнениям \\ Задача №1}

\begin{document}

\maketitle

\section{Постановка задачи и теоретическое обоснование}
Для задачи 
\begin{flalign}
& ~~~~y'(x) + A y(x) = 0, ~y(0) = 1, ~x \in [0, 10] &
\end{flalign}
с точным решением $y(x) = e^{-Ax}$ рассматриваются следующие разностные схемы:
\begin{flalign*}
& ~~~1) \frac{y_{k+1} - y_k}{h} + Ay_k = 0, ~y_0 = 1. & \\
& ~~~2) \frac{y_{k+1} - y_k}{h} + Ay_{k+1} = 0, ~y_0 = 1. & \\
& ~~~3) \frac{y_{k+1} - y_k}{h} + A\frac{y_{k+1} + y_k}{2}= 0, ~y_0 = 1. & \\
& ~~~4) \frac{y_{k+1} - y_{k-1}}{2h} + Ay_{k} = 0, ~y_0 = 1, ~y_1 = 1 - Ah. & \\
& ~~~5) \frac{1.5y_{k+1} - 2y_{k} + 0.5y_{k-1}}{h} + Ay_{k-1} = 0, ~y_0 = 1, ~y_1 = 1 - Ah. &
\end{flalign*}
Для каждой схемы найти порядок аппроксимации, проверить условие устойчивости, обосновать сходимость; численно оценить порядок сходимости при $A = 1,2,5,10, ~h = 10^{-m}, ~ m = 1,\dots, 9.$

\begin{defin}
Говорят, что разностная схема \textit{аппроксимирует на решении $y$ с порядком аппроксимации} $p = \min(p_1, p_2)$ соответствующую дифференциальную задачу, если существуют такие постоянные $h_0, ~c_1, ~p_1, ~c_2$ и $p_2$, что для всех $h \leq h_0$ выполняются неравенства
\begin{equation*}
\| L_h(u)_{U_h} - f_h \|_{F_h} \leq c_1h^{p_1}, ~~ \| l_h(u)_{U_h} - \varphi_h \|_{\Phi_h} \leq c_2h^{p_2},
\end{equation*}
причём $c_1, ~p_1, ~c_2$ и $p_2$ не зависят от $h$ и выполнены условия нормировки
\begin{equation*}
\lim_{h \rightarrow 0} \| f_h - (f)_{F_h} \|_{F_h} = 0, ~\lim_{h \rightarrow 0} \| \varphi_h - (\varphi_h)_{\Phi_h} \|_{\Phi_h} = 0.
\end{equation*}
\end{defin}

\begin{defin}
Разностная схема \textit{устойчива}, если существует такое $h_0 > 0$, что для любого $\varepsilon > 0$ найдётся такое $\delta = \delta(\varepsilon)$, что для произвольных функций $u_h^{(i)}, i = 1,2$, являющихся решениями разностной задачи, задаваемой этой схемой, из неравенств
\begin{equation*}
h \leq h_0, \| f_h^{(1)} - f_h^{(2)} \|_{F_h} \leq \delta, \| \varphi_h^{(1)} - \varphi_h^{(2)} \|_{\Phi_h} \leq \delta
\end{equation*}
следует оценка $\| u_h^{(1)} - u_h^{(2)} \|_{U_h} \leq \varepsilon$.
\end{defin}

\begin{defin}
Разностная схема называется \textit{$\alpha-$устойчивой}, если все корни характеристического уравнения, соответствующего уравнению $(L_hy_h)_k = 0$, лежат внутри комплексной единичной окружности, причём корни с $| \mu_i| = 1$ должны иметь кратность 1.
\end{defin}


\begin{exercise}
Решение разностного аналога дифференциальной задачи (1)
\begin{flalign*}
& ~~~~~~\frac{y_{k+1} - y_k}{h} = -Ay_k, ~y_0 = 1. &
\end{flalign*}
сходится к решению этой дифф. задачи с порядком 1.
\end{exercise}
\begin{proof}
Необходимо проверить аппроксимацию на решении и устойчивость. Проверим по определению:
\begin{flalign*}
\frac{y(x_{k+1}) - y(x_k)}{h} + Ay(x_k) = \frac{y(x_{k}+h) - y(x_k)}{h} + Ay(x_k) = ~~~~~~~~~~~~~~~~~~~~\\
= \frac{y(x_{k}) + y'(x_k)h + O(h^2) - y(x_k)}{h} + Ay(x_k) = y'(x_k) + O(h) + Ay(x_k) = \\
= y'(x_k) + Ay(x_k) + O(h) = O(h) ~~( y'(x_k) + Ay(x_k) = 0)
\end{flalign*}
Значит, эта схема аппроксимирует задачу (1) на решении с порядком 1. Далее нужно проверить устойчивость. Известно, что в дифференциальных задачах первого порядка вместо устойчивости можно проверять $\alpha-$устойчивость. Соответствующее уравнение:
\begin{flalign*}
\frac{y(x_{k+1}) - y(x_k)}{h} = 0.
\end{flalign*}
Подставим $y_k = \mu^k$, получим уравнение $\mu - 1 = 0$ c единственным корнем $\mu = 1$ кратности 1. Значит, схема $\alpha-$устойчива, и по теореме Филиппова решение разностной задачи сходится к решению дифференциальной с порядком 1.
\end{proof}


\begin{exercise}
Решение разностного аналога дифференциальной задачи (1)
\begin{flalign*}
& ~~~~~~\frac{y_{k+1} - y_k}{h} = -Ay_{k+1}, ~y_0 = 1. &
\end{flalign*}
сходится к решению этой дифф. задачи с порядком 1.
\end{exercise}
\begin{proof}
Необходимо проверить аппроксимацию на решении и устойчивость. Проверим по определению:
\begin{flalign*}
\frac{y(x_{k+1}) - y(x_k)}{h} + Ay(x_{k+1}) = \frac{y(x_{k}+h) - y(x_k)}{h} + Ay(x_k+h) = ~~~~~~~~~~~~~~~~~~~~\\
= \frac{y(x_{k}) + y'(x_k)h + O(h^2) - y(x_k)}{h} + Ay(x_k) + O(h) = y'(x_k) + Ay(x_k) + O(h)= \\
= O(h) ~~( y'(x_k) + Ay(x_k) = 0)
\end{flalign*}
Значит, эта схема аппроксимирует задачу (1) на решении с порядком 1. Далее нужно проверить устойчивость. Известно, что в дифференциальных задачах первого порядка вместо устойчивости можно проверять $\alpha-$устойчивость. Соответствующее уравнение:
\begin{flalign*}
\frac{y(x_{k+1}) - y(x_k)}{h} = 0.
\end{flalign*}
Подставим $y_k = \mu^k$, получим уравнение $\mu - 1 = 0$ c единственным корнем $\mu = 1$ кратности 1. Значит, схема $\alpha-$устойчива, и по теореме Филиппова решение разностной задачи сходится к решению дифференциальной с порядком 1.
\end{proof}

\begin{exercise}
Решение разностного аналога дифференциальной задачи (1)
\begin{flalign*}
& ~~~~~~\frac{y_{k+1} - y_k}{h} = -A\frac{y_{k+1} + y_{k}}{2}, ~y_0 = 1. &
\end{flalign*}
сходится к решению этой дифф. задачи \textbf{с порядком 2}.
\end{exercise}
\begin{proof}
Необходимо проверить аппроксимацию на решении и устойчивость. В отличие от двух предыдущих задач, будем раскладывать решение в ряд Тейлора в точке $x_k + \frac{h}{2}$:
\begin{flalign*}
&~~~~~~y(x_k + \tfrac{h}{2} \pm \tfrac{h}{2}) = y(x_k + \tfrac{h}{2}) \pm y'(x_k + \tfrac{h}{2})\tfrac{h}{2} + y''(x_k + \tfrac{h}{2})\tfrac{h^2}{8} + O(h^3)&
\end{flalign*}
\begin{flalign*}
&~~~~~~y(x_{k+1}) - y(x_k) = y(x_k + \tfrac{h}{2} + \tfrac{h}{2}) - y(x_k + \tfrac{h}{2} - \tfrac{h}{2}) = y'(x_k + \tfrac{h}{2})h + O(h^3)&
\end{flalign*}
\begin{flalign*}
&~~~~~~y(x_{k+1}) + y(x_k) = 2y(x_k + \tfrac{h}{2}) + O(h^2)&
\end{flalign*}
И тогда: 
\begin{flalign*}
\frac{y_{k+1} - y_k}{h} + A\frac{y_{k+1} + y_{k}}{2} = y'(x_k + \tfrac{h}{2}) + O(h^2) + Ay(x_k + \tfrac{h}{2}) + O(h^2) = O(h^2)
\end{flalign*}
Значит, эта схема аппроксимирует задачу (1) на решении с порядком 2. Устойчивость проверяется аналогично двум предыдущим задачам. Следовательно, по теореме Филиппова решение разностной задачи сходится к решению дифференциальной \textbf{с порядком 2}.
\end{proof}


\begin{exercise}
Решение разностного аналога дифференциальной задачи (1)
\begin{flalign*}
& ~~~~~~\frac{y_{k+1} - y_{k-1}}{2h} = -Ay_{k} , ~y_0 = 1, ~y_1 = 1 - Ah. &
\end{flalign*}
сходится к решению этой дифф. задачи \textbf{с порядком 2}.
\end{exercise}
\begin{proof}
Необходимо проверить аппроксимацию на решении и устойчивость. Будем раскладывать решение в ряд Тейлора в точке $x_k$:
\begin{flalign*}
&~~~~~~y(x_k \pm h) = y(x_k) \pm y'(x_k )h + y''(x_k )\tfrac{h^2}{2} + O(h^3)&
\end{flalign*}
Тогда: 
\begin{flalign*}
\frac{y_{k+1} - y_{k-1}}{h} + Ay_k = \frac{2y'(x_k)h + O(h^3)}{2h} + Ay_k = y'(x_k) + Ay_k + O(h^2) = O(h^2)
\end{flalign*}
Значит, эта схема аппроксимирует задачу (1) на решении с порядком 2. Проверим $\alpha-$устойчивость:
\begin{flalign*}
\frac{y(x_{k+1}) - y(x_{k-1})}{h} = 0.
\end{flalign*}
Отсюда имеем характеристическое уравнение $\mu^2 - 1 = 0$ с корнями $\mu_{1,2} = \pm 1$, оба кратности 1, а значит достаточное условие $\alpha-$устойчивости выполняется.

Следовательно, по теореме Филиппова решение разностной задачи сходится к решению дифференциальной \textbf{с порядком 2}.
\end{proof}

\begin{exercise}
Решение разностного аналога дифференциальной задачи (1)
\begin{flalign*}
& ~~~~~~\frac{1.5y_{k+1} - 2y_k + 0.5y_{k-1}}{h}= -Ay_{k-1} , ~y_0 = 1, ~y_1 = 1 - Ah. &
\end{flalign*}
сходится к решению этой дифф. задачи \textbf{с порядком 1}.
\end{exercise}
\begin{proof}
Необходимо проверить аппроксимацию на решении и устойчивость. Будем раскладывать решение в ряд Тейлора в точке $x_k$:
\begin{flalign*}
&~~~~~~y(x_k \pm h) = y(x_k) \pm y'(x_k )h + O(h^2)&
\end{flalign*}
Тогда: 
\begin{flalign*}
\frac{3y(x_{k} + h) - 4y(x_k) + y(x_{k}-h)}{2h} + Ay(x_{k-1}) = \frac{2y'(x_k)h + O(h^2)}{2h} + A(y(x_k) + O(h)) = \\
= y'(x_k) + Ay(x_k) + O(h) = O(h)
\end{flalign*}
Значит, эта схема аппроксимирует задачу (1) на решении с порядком 1. Проверим $\alpha-$устойчивость:
\begin{flalign*}
\frac{3y(x_{k+1}) - 4y_k + y(x_{k-1})}{2h} = 0.
\end{flalign*}
Отсюда имеем характеристическое уравнение $3\mu^2 - 4\mu + 1 = 0$ с корнями $\mu_1 = 1, \mu_2 = 1/3$, оба кратности 1 и не выходят за пределы единичной комплексной окружности, а значит достаточное условие $\alpha-$устойчивости выполняется.

Следовательно, по теореме Филиппова решение разностной задачи сходится к решению дифференциальной \textbf{с порядком 1}.
\end{proof}



\section{Описание программы и численные результаты}

Нужно фактически решить 5 задач. Совмещу их все в одной программе. Для каждого пункта нужно написать некоторую разновидность итеративного алгоритма, который будет от $y_k$ переходить к $y_{k+1}$. В функции \textbf{main} с клавиатуры задаются множитель A из условия задачи и выбирается номер подпункта, который в данный момент программа будет решать. Далее запускается цикл по $N$ от 10 до $10^7$ с умножением $N$ на 10 при переходе между итерациями. На каждой итерации запускается функция 

\begin{center}
\textbf{void step\_*(double* y, double* x, double h, double A, int N);}
\end{center}
где вместо знака * стоит номер решаемого в данный момент пункта задачи.

Функции \textbf{step\_*} работают по формулам, приведённым ниже:

\begin{flalign*}
& ~~~1) y_{k+1} = y_k + h \cdot f(y_k, A) & \\
& ~~~2) y_{k+1} = \frac{1}{1 + hA} y_k & \\
& ~~~3) y_{k+1} = \frac{2 - hA}{2 + hA} y_k & \\
& ~~~4) y_{k+1} = y_{k-1} + 2h \cdot f(y_k, A) & \\
& ~~~5) y_{k+1} = \frac{4}{3} y_k - \frac{1}{3} y_{k-1} + \frac{1}{3}\cdot 2h \cdot f(y_{k-1}, A); &
\end{flalign*}

Далее функция 
\begin{center}
\textbf{void error(double* y, double* x, double h, double A, int N, int mode);}
\end{center}
высчитывает С-норму разности вектора, получившегося в результате работы функции \textbf{step\_*}, и вектора-следа на узлы реальной функции решения в этой задаче - $e^{-Ax}$. А затем выводит её на экран, деля либо на $h$, либо на $h^2$, в зависимости от порядка сходимости в данном подпункте задачи. Получаем почти константу, которая иногда начинает колебаться, приближаясь к последним значениям $N$.
 
 Приведу графики поведения ошибки при увеличении N.
 
\subsection{Пункт 1}
\includegraphics[scale = 0.56]{first_mode}

\subsection{Пункт 2}
\includegraphics[scale = 0.56]{second_mode}

\subsection{Пункт 3}
\includegraphics[scale = 0.56]{third_mode}

\subsection{Пункт 4}
\includegraphics[scale = 0.56]{forth_mode}

Остальные 3 слишком малы, чтобы попасть на график.

\subsection{Пункт 5}
\includegraphics[scale = 0.56]{fifth_mode}


\end{document}